<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Water Drop — charity: water Final Prototype</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--cw-yellow:#ffd400;--cw-blue:#0aa3ff;--cw-dark:#0b0b0b;--bg:#f6fbff;--card:#ffffff;--max-width:1000px}
    *{box-sizing:border-box;font-family:Montserrat, system-ui, -apple-system, 'Segoe UI', Roboto, Arial}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#e8f4ff);color:var(--cw-dark)}
    .wrap{max-width:var(--max-width);margin:18px auto;padding:16px}
    header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:10px;background:var(--cw-yellow);display:flex;align-items:center;justify-content:center;font-weight:700;color:#111}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:10px;align-items:center}
    select,button{font-family:inherit;padding:8px 12px;border-radius:10px;border:0;cursor:pointer}
    button.secondary{background:#fff;border:1px solid rgba(0,0,0,0.06)}
    button.primary{background:var(--cw-yellow)}
    .stat{background:var(--card);padding:8px 12px;border-radius:10px;box-shadow:0 6px 16px rgba(10,20,40,0.06);min-width:88px;text-align:center}
    .stat .label{font-size:12px;color:#666}.stat .value{font-weight:700;font-size:18px}
    .game-wrap{background:linear-gradient(180deg,#dff3ff,white);border-radius:14px;padding:12px;box-shadow:0 10px 34px rgba(8,20,40,0.08)}
    .game-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;gap:12px}
    .playfield{position:relative;height:560px;border-radius:12px;overflow:hidden;background:linear-gradient(#e8faff,#f2fbff);border:2px solid rgba(0,0,0,0.04)}
    .topbar{display:flex;gap:10px;align-items:center;padding:6px 0}
    .drop{position:absolute;width:56px;height:72px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;color:white;user-select:none;touch-action:manipulation;transform-origin:center center;transition:transform 120ms linear}
    .drop.good{background:linear-gradient(180deg,var(--cw-blue),#1b8ee8);box-shadow:0 8px 16px rgba(10,160,255,0.12)}
    .drop.bad{background:linear-gradient(180deg,#7b7b7b,#4a4a4a);box-shadow:0 8px 16px rgba(0,0,0,0.12)}
    .drop .emoji{font-size:26px}
    .popup{position:absolute;padding:6px 10px;border-radius:8px;background:rgba(255,255,255,0.98);box-shadow:0 6px 14px rgba(20,40,80,0.06);transform:translate(-50%,-120%);white-space:nowrap;pointer-events:none}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.65);backdrop-filter:blur(2px);z-index:40}
    .panel{background:white;padding:18px;border-radius:12px;box-shadow:0 12px 40px rgba(8,20,40,0.12);max-width:480px;text-align:center}
    footer{margin-top:12px;padding:12px 6px;text-align:center;color:#444;font-size:14px;border-top:1px solid rgba(12,30,60,0.03)}
    footer a{color:var(--cw-blue);text-decoration:none;font-weight:600}
    @media (max-width:820px){.playfield{height:62vh}.drop{width:44px;height:56px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">cw</div>
        <div>
          <h1>Water Drop — charity: water (Final)</h1>
          <div style="font-size:12px;color:#666">Collect clean water, avoid dirty drops, help spread awareness.</div>
        </div>
      </div>
      <div class="controls">
        <label style="font-size:13px;color:#444">Difficulty</label>
        <select id="difficulty">
          <option value="easy">Easy</option>
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
        </select>
        <div class="stat"><div class="label">Score</div><div id="score" class="value">0</div></div>
        <div class="stat"><div class="label">Time</div><div id="timer" class="value">60</div></div>
        <button id="startBtn" class="primary">Start</button>
        <button id="resetBtn" class="secondary">Reset</button>
      </div>
    </header>
    <div class="game-wrap">
      <div class="game-meta topbar">
        <div style="flex:1;color:#333">Tip: Tap or click clean drops (+1). Avoid dirty drops (-2). Different difficulties change goals and pace.</div>
        <div style="font-size:14px;color:#333">Target: <strong id="targetLabel">15</strong></div>
      </div>
      <div id="playfield" class="playfield" aria-live="polite" tabindex="0">
        <canvas id="confettiCanvas" style="position:absolute;inset:0;pointer-events:none;z-index:50"></canvas>
        <div id="message" style="position:absolute;left:50%;top:14px;transform:translateX(-50%);z-index:45"></div>
      </div>
      <div style="padding:10px 6px;text-align:center;color:#555;font-size:14px">Improvements: difficulty modes, milestones, audio cues, confetti, brand footer links, responsive layout.</div>
    </div>
    <footer>
      <div>Learn more about charity: water — <a href="https://www.charitywater.org" target="_blank" rel="noopener">charity: water</a>
      • Donate: <a href="https://www.charitywater.org/donate" target="_blank" rel="noopener">charity: water donate</a></div>
    </footer>
  </div>
<script>
(() => {
  const DIFFICULTY = {
    easy:   { spawnInterval: 1000, badChance: 0.12, timer: 75, target: 10, speedMul: 0.9 },
    normal: { spawnInterval: 800,  badChance: 0.22, timer: 60, target: 15, speedMul: 1.0 },
    hard:   { spawnInterval: 550,  badChance: 0.32, timer: 45, target: 20, speedMul: 1.3 },
  };
  const playfield = document.getElementById('playfield');
  const scoreEl = document.getElementById('score');
  const timerEl = document.getElementById('timer');
  const targetLabel = document.getElementById('targetLabel');
  const difficultySel = document.getElementById('difficulty');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const messageWrap = document.getElementById('message');
  const confCanvas = document.getElementById('confettiCanvas');
  const confCtx = confCanvas.getContext('2d');
  let width, height;
  function resizeCanvas(){ width = playfield.clientWidth; height = playfield.clientHeight; confCanvas.width = width; confCanvas.height = height; }
  window.addEventListener('resize', resizeCanvas); resizeCanvas();
  let drops = [];
  let score = 0;
  let collected = 0;
  let running = false;
  let timer = 60;
  let spawnIntervalId = null;
  let rafId = null;
  let countdownId = null;
  let gameEnd = false;
  let config = DIFFICULTY.normal;
  let milestones = [];
  let triggeredMilestones = new Set();
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  function playBeep(type = 'collect'){
    const now = audioCtx.currentTime;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    if (type === 'collect'){ o.type='sine'; o.frequency.setValueAtTime(800, now); g.gain.setValueAtTime(0.001, now); g.gain.linearRampToValueAtTime(0.12, now+0.01); g.gain.exponentialRampToValueAtTime(0.001, now+0.22); o.start(now); o.stop(now+0.22); }
    else if (type === 'bad'){ o.type='square'; o.frequency.setValueAtTime(220, now); g.gain.setValueAtTime(0.001, now); g.gain.linearRampToValueAtTime(0.16, now+0.02); g.gain.exponentialRampToValueAtTime(0.001, now+0.35); o.start(now); o.stop(now+0.35); }
    else if (type === 'win'){ const o1 = audioCtx.createOscillator(), o2 = audioCtx.createOscillator(), o3 = audioCtx.createOscillator(); const g2 = audioCtx.createGain(); o1.frequency.value = 440; o2.frequency.value = 660; o3.frequency.value = 880; o1.connect(g2); o2.connect(g2); o3.connect(g2); g2.connect(audioCtx.destination); g2.gain.setValueAtTime(0.001, now); g2.gain.linearRampToValueAtTime(0.18, now+0.02); g2.gain.exponentialRampToValueAtTime(0.001, now+1.1); o1.start(now); o2.start(now); o3.start(now); o1.stop(now+1.1); o2.stop(now+1.1); o3.stop(now+1.1); }
    else { o.type='sine'; o.frequency.setValueAtTime(520, now); g.gain.setValueAtTime(0.001, now); g.gain.linearRampToValueAtTime(0.08, now+0.01); g.gain.exponentialRampToValueAtTime(0.001, now+0.12); o.start(now); o.stop(now+0.12); }
  }
  let confettiParticles = [], confettiRaf = null;
  function startConfetti(){ confettiParticles = []; for (let i=0;i<220;i++){ confettiParticles.push({ x: Math.random()*width, y: Math.random()*-height*0.4, vx: (Math.random()-0.5)*6, vy: Math.random()*2+2, size: Math.random()*8+4, life: Math.random()*120+60, col: `hsl(${Math.floor(Math.random()*50)+30},90%,55%)` }); } cancelAnimationFrame(confettiRaf); confettiRaf = requestAnimationFrame(confettiLoop); setTimeout(()=> stopConfetti(), 7000); }
  function confettiLoop(){ confCtx.clearRect(0,0,width,height); for (let i=confettiParticles.length-1;i>=0;i--){ const p = confettiParticles[i]; p.x += p.vx; p.y += p.vy; p.vy += 0.04; p.life--; confCtx.save(); confCtx.translate(p.x, p.y); confCtx.rotate((p.life%20)/20); confCtx.fillStyle = p.col; confCtx.fillRect(-p.size/2, -p.size/2, p.size, p.size*1.6); confCtx.restore(); if (p.y > height+50 || p.life <= 0) confettiParticles.splice(i,1); } if (confettiParticles.length>0) confettiRaf = requestAnimationFrame(confettiLoop); }
  function stopConfetti(){ if (confettiRaf) cancelAnimationFrame(confettiRaf); confettiParticles=[]; confCtx.clearRect(0,0,width,height); }
  function setScore(v){ score = v; scoreEl.textContent = score; }
  function showMessage(text, time=900){ messageWrap.innerHTML = `<div class="popup">${text}</div>`; setTimeout(()=>{ if (messageWrap.firstChild) messageWrap.innerHTML=''; }, time); }
  function spawnDrop(){ const isBad = Math.random() < config.badChance; const el = document.createElement('div'); el.className = 'drop ' + (isBad ? 'bad' : 'good'); const left = Math.floor(Math.random() * Math.max(20, width - 80)); el.style.left = left + 'px'; el.style.top = '-90px'; el.innerHTML = `<div class="emoji">${isBad ? '🫥' : '💧'}</div>`; playfield.appendChild(el); const baseSpeed = 60 + Math.random()*140; const drop = { el, y:-90, x:left, speed: baseSpeed * config.speedMul, isBad, collected:false, born:Date.now() }; el.addEventListener('click', (e) => { if (!running) return; collect(drop); e.stopPropagation(); }); el.addEventListener('touchstart', (e) => { if (!running) return; collect(drop); e.stopPropagation(); }, {passive:true}); drops.push(drop); }
  function collect(drop){ if (!drop || drop.collected) return; drop.collected = true; const fx = document.createElement('div'); fx.className='popup'; fx.textContent = drop.isBad ? '-2' : '+1'; fx.style.left = (drop.x + 28) + 'px'; fx.style.top = (drop.y + 8) + 'px'; playfield.appendChild(fx); setTimeout(()=> fx.remove(), 700); if (drop.isBad){ setScore(Math.max(0, score - 2)); playBeep('bad'); showMessage('Dirty water! -2', 900); } else { setScore(score + 1); collected++; playBeep('collect'); showMessage('Nice! +1', 700); } drop.el.style.transform = 'scale(0.2) rotate(15deg)'; drop.el.style.opacity = '0'; setTimeout(()=> { try{ drop.el.remove(); }catch(e){} }, 160); checkMilestones(); checkWin(); }
  function update(dt){ for (let i = drops.length - 1; i >= 0; i--){ const d = drops[i]; if (d.collected){ drops.splice(i,1); continue; } d.y += d.speed * dt; d.el.style.top = d.y + 'px'; if (d.y > height - 30){ d.el.remove(); drops.splice(i,1); if (!d.isBad){ showMessage('Missed...', 500); } } } }
  let lastT = null; function loop(t){ if (!lastT) lastT = t; const dt = (t - lastT) / 1000; lastT = t; update(dt); rafId = requestAnimationFrame(loop); }
  function start(){ if (running) return; if (audioCtx.state === 'suspended') audioCtx.resume(); running = true; gameEnd = false; lastT = null; triggeredMilestones.clear(); setScore(0); collected = 0; timer = config.timer; timerEl.textContent = timer; prepareMilestones(); spawnIntervalId = setInterval(() => spawnDrop(), config.spawnInterval); rafId = requestAnimationFrame(loop); countdownId = setInterval(() => { if (!running) return; timer -= 1; timerEl.textContent = timer; if (timer <= 0){ clearInterval(countdownId); running = false; endGame(); } }, 1000); startBtn.textContent = 'Playing'; startBtn.disabled = true; playBeep('click'); }
  function stop(){ running = false; if (spawnIntervalId) clearInterval(spawnIntervalId); spawnIntervalId = null; if (rafId) cancelAnimationFrame(rafId); rafId = null; if (countdownId) clearInterval(countdownId); countdownId = null; }
  function reset(fullReset=true){ stop(); drops.forEach(d => { try{ d.el.remove(); }catch(e){} }); drops = []; setScore(0); collected = 0; timer = config.timer; timerEl.textContent = timer; triggeredMilestones.clear(); messageWrap.innerHTML = ''; stopConfetti(); startBtn.textContent = 'Start'; startBtn.disabled = false; if (fullReset) playBeep('click'); }
  function endGame(){ stop(); if (!gameEnd){ showOverlay('Time — game over', `Your score: ${score}`, false); playBeep('bad'); } }
  function showOverlay(title, body, isWin=true){ const ov = document.createElement('div'); ov.className='overlay'; ov.innerHTML = `<div class="panel"><h2 style="margin:0 0 8px">${title}</h2><p style="margin:0 0 12px">${body}</p><div style="display:flex;gap:8px;justify-content:center"><button id="ovReset">Reset</button><button id="ovClose" class="secondary">Close</button></div></div>`; playfield.appendChild(ov); document.getElementById('ovReset').addEventListener('click', ()=>{ ov.remove(); reset(); }); document.getElementById('ovClose').addEventListener('click', ()=>{ ov.remove(); }); }
  function applyDifficulty(name){ config = DIFFICULTY[name] || DIFFICULTY.normal; targetLabel.textContent = config.target; timer = config.timer; timerEl.textContent = timer; reset(false); }
  difficultySel.addEventListener('change', (e)=>{ applyDifficulty(e.target.value); });
  function prepareMilestones(){ milestones = [ {score: Math.ceil(config.target*0.25), text: "Nice start!"}, {score: Math.ceil(config.target*0.5),  text: "Halfway there!"}, {score: Math.ceil(config.target*0.75), text: "Almost there!"}, {score: config.target,                text: "Goal reached!"} ]; }
  function checkMilestones(){ for (const m of milestones){ if (!triggeredMilestones.has(m.score) && score >= m.score){ triggeredMilestones.add(m.score); showMessage(m.text, 1200); if (m.score === config.target){ playBeep('win'); } } } }
  function checkWin(){ if (score >= config.target && !gameEnd){ gameEnd = true; stop(); showOverlay('You win! 🎉', `Score ${score} — thank you!`, true); startConfetti(); playBeep('win'); } }
  startBtn.addEventListener('click', ()=>{ if (!running) start(); }); resetBtn.addEventListener('click', ()=>{ reset(); });
  window.addEventListener('keydown', (e) => { if (e.code === 'Space'){ if (!running){ e.preventDefault(); spawnDrop(); } } if (e.code === 'Enter'){ if (!running) start(); } });
  applyDifficulty(difficultySel.value); setScore(0); window._WD = { spawnDrop, reset, start, setDifficulty: applyDifficulty };
})();
</script>
</body>
</html>
